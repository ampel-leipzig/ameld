---
title: Introduction to ameld
output:
    rmarkdown::html_vignette:
        toc_float: true
vignette: >
    %\VignetteIndexEntry{Introduction to ameld}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
Sys.setenv(LANGUAGE = "en")
library("ameld")
library("survival")

data(eldd)
data(eldr)
```

**Authors**: `r packageDescription("ameld")[["Author"]] `<br />
**Last modified:** `r file.info("ameld.Rmd")$mtime`<br />
**Compiled**: `r date()`

# The `ameld` Package

The `ameld` R package provides a dataset, `eldd`,
of patients evaluated for liver transplantation at the
University Hospital of Leipzig from
`r paste(strftime(attr(eldd, "period"), "%B %Y"), collapse = " to ")`.
`eldr` contains the reference limits for the laboratory measurements used in
`eldd`.

# Access the Data

The datasets could be loaded as follows:

```{r}
library("ameld")
data(eldd)
data(eldr)
```

# Survival Estimates

The `ameld` package provides a `plot_surv` function that is similar to
`survival::plot.survfit()` but uses different defaults:

```{r}
library("survival")

srv <- Surv(eldd$DaysAtRisk, eldd$Deceased)

srvfit <- survfit(srv ~ 1)

plot_surv(
    srvfit,
    main = "Kaplan-Meier Survival Estimate"
)

plot_surv(
    srvfit,
    cumhaz = TRUE,
    main = "Cumulative Hazard"
)

```

A more complex example of the survival plot with risk tables
could be generated by combining `plot_surv` and `plot_table`:

```{r combined-surv-plot, fig.width=7, fig.height=9}
## timepoints of interest
times <- c(0, 30, 90)

## calculate risk tables
sm <- summary(srvfit, times = times)
nrisk <- as.matrix(sm$n.risk)
ncumevents <- as.matrix(cumsum(sm$n.event))
rownames(nrisk) <- rownames(ncumevents) <- times

## keep old graphic parameters and restore them afterwards
old.par <- par(no.readonly = TRUE)

layout(matrix(1:3, nrow = 3), height = c(5, 1, 1))
par(cex.main = 2)
plot_surv(
    srvfit,
    main = "Kaplan-Meier Survival Estimate to day 90",
    times = times,
    xmax = 90
)
par(mar = c(2.1, 4.1, 4.1, 2.1))
plot_table(
    nrisk, at = times, main = "Number at risk",
    xaxis = FALSE, cex.text = 1.5
)
par(mar = c(5.1, 4.1, 1.1, 2.1))
plot_table(
    ncumevents, at = times, main = "Cumulative number of events",
    cex.text = 1.5
)

par(old.par)
```

# Acknowledgment

This work is part of the [AMPEL](https://ampel.care/en/)
(Analysis and Reporting System for the Improvement of Patient Safety through
Real-Time Integration of Laboratory Findings) project.

This measure is co-funded with tax revenues based on the budget adopted by
the members of the Saxon State Parliament.

# Session Information

```{r sessionInfo}
sessionInfo()
```
